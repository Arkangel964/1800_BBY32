<!doctype html>
<html lang="en">
  <head>
   
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
        
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <link rel="stylesheet" href="../styles/editprofileStyle.css">

    <title>Preferences</title>

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
      </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="../scripts/firebaseAPI.js"></script>
    
  </head>
  <body>

  <div class="container rounded bg-white mt-5 mb-5">
      <div class="row">
         <div class="border-right">
            <div class="p-3 pt-4 pb-5">
                <div class="gap-2 mb-4">
                  <a type="button" class="btn btn-light" id="back" onclick="goBack()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"></path>
                    </svg>
                  </a>
                  <a href="../main.html" class="btn btn-md btn-secondary float-end" type="button">Skip for now</a>
                </div>

                <div class="mb-5">
                    <h6 class="display-6 mb-3">What are your favourite game genres? (select all that apply)</h6>
                    <div class="pt-1 ps-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="moba">
                        <label class="form-check-label" for="moba">
                          MOBA
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="battleRoyale">
                        <label class="form-check-label" for="battleRoyale">
                          Battle Royale 
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="rts">
                        <label class="form-check-label" for="rts">
                          RTS
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="shooter">
                        <label class="form-check-label" for="shooter">
                          Shooter
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="mmorpg">
                        <label class="form-check-label" for="mmorpg">
                          MMORPG
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="story">
                        <label class="form-check-label" for="story">
                          Story
                        </label>
                      </div>
                    </div>
                </div>

                <div class="mb-5">
                  <h6 class="display-6 mb-3">What's your usual playstyle?</h6>
                  <select class="form-select form-select-md mb-3" id="playstyle" aria-label=".form-select-lg example">
                    <option value="casual">Casual</option>
                    <option value="medium">Medium</option>
                    <option value="hardcore">Hardcore</option>
                  </select>
                </div>
                
                <div class="mb-5">
                  <h6 class="display-6 mb-3">How often do you play games?</h6>
                  <div class="pt-1 ps-3">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="schedule" value="1" id="schedule1">
                      <label class="form-check-label" for="schedule1">
                        I almost play everyday
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="schedule" value="2" id="schedule2">
                      <label class="form-check-label" for="schedule2">
                        I usually play on weekends
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="schedule" value="3" id="schedule3">
                      <label class="form-check-label" for="schedule3">
                        I play occasionally when I have time
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="schedule" value="0" id="schedule4">
                      <label class="form-check-label" for="schedule4">
                        Other
                      </label>
                    </div>
                  </div>
              </div>

              <div class="mt-4 text-center d-grid gap-2 d-md-flex justify-content-end">
                <a class="btn btn-info" id="next" type="button">Next Step</a>
              </div>
              </div>
          </div>
      </div>
  </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
      const myStorage = window.sessionStorage;

      document.getElementById("next").addEventListener("click", function() {
        setData()
        savePreferences();
      });
      
      async function goBack(){
        await setData();
        window.location.assign("basicinfo.html");
      };

      function savePreferences() {
        firebase.auth().onAuthStateChanged(user => {
          if (user) {
            currentUser = db.collection("users").doc(user.uid);
            
            let userMOBA = document.getElementById('moba').checked;
            let userBattleRoyale = document.getElementById('battleRoyale').checked;
            let userRTS = document.getElementById('rts').checked;
            let userShooter = document.getElementById('shooter').checked;
            let userMMORPG = document.getElementById('mmorpg').checked;
            let userStory = document.getElementById('story').checked;
            let userPlaystyle = document.getElementById('playstyle').value;
            let userSchedule = $('input[name=schedule]:checked').val();
            
            if (userSchedule === undefined) {
              userSchedule = null;
            }

            currentUser.update({
              moba: userMOBA,
              battleRoyale: userBattleRoyale,
              rts: userRTS,
              shooter: userShooter,
              mmorpg: userMMORPG,
              story: userStory,
              playstyle: userPlaystyle,
              schedule: userSchedule
            }).then(() => {
              console.log("Document successfully updated!");
              window.location.assign("avatar-bio.html");
            })
          }
        });
      }

      function setData() {
        let userMOBA = document.getElementById('moba').checked;
        let userBattleRoyale = document.getElementById('battleRoyale').checked;
        let userRTS = document.getElementById('rts').checked;
        let userShooter = document.getElementById('shooter').checked;
        let userMMORPG = document.getElementById('mmorpg').checked;
        let userStory = document.getElementById('story').checked;
        let userPlaystyle = document.getElementById('playstyle').value;
        let userSchedule = $('input[name=schedule]:checked').val();

        myStorage.setItem("moba", userMOBA);
        myStorage.setItem("battleRoyale", userBattleRoyale);
        myStorage.setItem("rts", userRTS);
        myStorage.setItem("shooter", userShooter);
        myStorage.setItem("mmorpg", userMMORPG);
        myStorage.setItem("story", userStory);
        myStorage.setItem("playstyle", userPlaystyle);
        myStorage.setItem("schedule", userSchedule);
      }

      function getData() {
        
        let moba = myStorage.getItem("moba");
        let battleRoyale = myStorage.getItem("battleRoyale");
        let rts = myStorage.getItem("rts");
        let shooter = myStorage.getItem("shooter");
        let mmorpg = myStorage.getItem("mmorpg");
        let story = myStorage.getItem("story");
        let playstyle = myStorage.getItem("playstyle");
        let schedule = myStorage.getItem("schedule");

        if (moba == 'true') {
          document.getElementById("moba").checked = true;
        }
        if (battleRoyale == 'true') {
          document.getElementById("battleRoyale").checked = true;
        }
        if (rts == 'true') {
          document.getElementById("rts").checked = true;
        }
        if (shooter == 'true') {
          document.getElementById("shooter").checked = true;
        }
        if (mmorpg == 'true') {
          document.getElementById("mmorpg").checked = true;
        } 
        if (story == 'true') {
          document.getElementById("story").checked = true;
        }
        if (playstyle != null) {
          document.getElementById("playstyle").value = playstyle;
        }
        if (schedule != null) {
          if (schedule == 0) {
            $('#schedule4').prop("checked", true);
          }
          if (schedule == 1) {
            $('#schedule1').prop("checked", true);
          }
          if (schedule == 2) {
            $('#schedule2').prop("checked", true);
          }
          if (schedule == 3) {
            $('#schedule3').prop("checked", true);
          }
        }
      }
      getData();

    </script>

  </body>
</html>